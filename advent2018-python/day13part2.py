#!/usr/bin/env python3

""" https://adventofcode.com/2018/day/2 """


inputstr = r"""
/->-\        
|   |  /----\
| /-+--+-\  |
| | |  | v  |
\-+-/  \-+--/
  \------/   
"""

inputstr = r"""
                            /-----------------\                   /--------------------------------------------------------------------------------\  
                       /----+----------\      |  /----------------+-------------------------------------------------------------------\            |  
                       |    |    /-----+---\  |  | /--------------+->-----------------------------------------------------------\     |            |  
                      /+----+----+-----+---+--+--+-+--------------+-----------------------\       /----<-------------------\    |     |            |  
   /------------------++----+----+-----+---+--+--+-+------------\ |      /----------------+-------+------------------------+----+-----+--\         |  
   |                  ||    |    |     |   |  |  | |            | |/-----+----------------+-------+--------------\         |    |     |  |         |  
   |                  ||    |    |     |   |  |  | |            | ||     v      /---------+-------+--------------+---------+----+-----+--+--\      |  
   |                  ||    |    |     |  /+--+--+-+--------\   | ||     |      |         | /-----+-------\  /---+---------+----+-----+-\|  |      |  
   |               /--++----+----+-----+--++--+--+-+--------+---+-++-----+------+---------+-+---\ |       |  |   |         |    |     | ||  |      |  
   |      /--------+--++----+----+-----+--++--+--+-+--------+---+-++-----+-----\|        /+-+---+-+-------+--+---+---------+----+-----+-++--+------+\ 
   |      | /------+--++----+----+-----+--++--+--+-+--------+---+-++----<+-----++--------++-+---+-+-\     |  |   |         |    |     | ||  |      || 
   |      | |      |  ||    |    |     |  ||  | /+-+--------+---+-++-----+-----++--------++-+---+-+-+-----+--+---+---------+----+-----+-++--+----\ || 
   |   /--+-+------+--++----+----+-----+--++-\| || |        |   | ||     |     ||        || |   | | |     |  |   |         |    |     | ||  |    | || 
   |   |  | |      |  ||    |    |     |  || || || |        |   | ||     |   /-++--------++-+---+-+-+-----+--+---+-\       |/---+-----+\||  |    | || 
   |   |  | |     /+--++----+----+-----+--++-++-++-+-------\|   | ||/----+---+-++--------++-+---+-+-+-----+--+---+-+-------++---+-----++++--+\   | || 
   |/--+--+-+-----++--++----+----+-----+--++-++-++-+-------++---+-+++----+---+\||        || |   | | |     |  |   | |       ||   |     ||||  ||   | || 
   ||  |  | |     ||  ||    |    \-----+--+/ || || |       ||   | |||    |   ||||        || |   | | |     |  |   | |       ||   |     ||||  ||   | || 
   ||  |  | |/----++--++----+----------+--+--++-++-+-------++---+-+++----+---++++--------++-+->-+-+-+-----+--+---+-+-----\ ||   |     ||||  ||   | || 
   ||  |  | ||    ||  ||    |          |  |  || |\-+-------++---+-+++----+---++++--------++-+---+-+-+-----+--+---+-+-----+-++---+-----/|||  ||   | || 
  /++--+--+-++--\ ||  ||    |          |  |  || |  |       ||   | |||    |   ||||        || |   | | |     |  |   | |     | ||   |      |||  ||   | || 
  |||  |  | ||  | ||  ||    |          |  \--++-+--+-------+/   | |||    |   ||||        || |   | | |     |  |   | |     | ||   |      |||  ||   | || 
  |||  |  | ||  | ||  ||    |          |     || |  |       |    | |||    |   |||| /------++-+---+-+-+-----+--+---+-+-----+-++---+-----\|||  ||   | || 
  |||  |  | ||  | ||  ||    |          |     || |  |       |    | |||    |   |||| |/-----++-+---+-+-+-----+--+---+-+-----+-++---+-\   ||||  ||   | || 
  |||  |  | ||  | ||  || /--+----------+-----++-+--+-------+----+-+++----+---++++\||     || |   | | |     |  |   | |     | ||   | |   ||||  ||   | || 
  |||  |  | ||  | ||  || |  |          |     || |  |       |    | |||    |   |||\+++-----++-+---+-+-+-----+--+---+-+-----+-++---+-+---++++--/|   | || 
  |||  |  | ||  | ||  || |  |          |     || | /+---->--+---\| |||    |   ||| |||    /++-+---+-+-+-----+--+---+-+-----+-++---+-+\  ||||   |   | || 
  |||  |  |/++--+-++--++-+--+----------+-----++-+-++-------+---++-+++----+---+++-+++----+++-+---+-+-+-----+--+---+-+---\ | ||   | ||  ||||   |   | || 
  |||  |  ||||  | ||  || |  |    /-----+-----++-+-++-------+---++-+++----+---+++-+++----+++-+---+-+-+-----+--+-\ | |   | | ||   | ||  ||||   |   | || 
  |||  |  ||||  | ||  || |  |    |     |     || | ||       |   || |\+----+---+++-+++----+++-+---+-+-+-----+--+-+-/ |   |/+-++---+-++--++++---+---+-++\
  |||  |  ||\+--+-++--++-+--+----+-----+-----++-+-++-------+---++-+-+----+---+++-+++----+++-+---+-+-/     |  | |   |   ||| ||   | ||  ||||   |   | |||
 /+++--+--++-+--+-++--++-+--+----+-----+-----++-+-++-------+---++-+-+----+---+++-+++----+++-+--\| |       |  | |   |   ||| ||   | ||  ||||   |   | |||
 ||||  |  || |  | ||  || |  |    |     |     || | ||       |   || | |    |   ||| |||    ||| \--++-+-------/  | |   |   ||| ||   | ||  ||||   |   | |||
 ||||  | /++-+--+-++--++-+--+----+-----+-\   || | ||   /---+---++-+-+----+---+++-+++----+++----++-+----------+-+---+---+++-++---+\||  ||||   |   | |||
 |||| /+-+++-+--+-++--++-+--+----+-----+-+---++-+-++---+---+---++-+-+----+---+++-+++----+++----++-+---\      | |   |   ||| ||   ||||  ||||   |   | |||
 |||| || ||| |  | ||  || |  |  /-+-----+-+---++-+-++---+---+---++-+-+--\ |   ||| |||    |\+----++-+---+------+-+---+---+++-++---++++--++++---+---+-+/|
 |||| || ||| |  v ||  |\-+--+--+-+-----/ |   || | ||   | /-+---++-+-+--+-+---+++-+++-\  | |    || |   |      | |   |   ||| ||   ||||  ||||   |   | | |
 |||| || ||| |  |/++--+--+--+--+-+-------+---++-+-++---+-+-+---++-+-+--+-+---+++-+++-+--+-+----++-+---+------+-+-\ |   ||| ||   ||||  ||||   |   | | |
 |||| || ||| |  ||||  |  |  |  | |       |   || | ||   | | |   || | |  | |   ||| |\+-+--+-+----++-+---+------+-+-+-+---+++-++---++++--/|||   |   | | |
 |||| || |||/+--++++--+--+--+--+-+-------+---++-+-++---+-+-+---++-+-+--+-+---+++-+-+-+--+-+----++-+---+------+-+-+-+-\ ||| ||   ||||   |||   |   | | |
 |||| || |||||  ||||  | /+--+--+-+-----\ |   || | ||   | | |   || | |  | |   ||| | | |  \-+----++-+---+------+-+-+-+-+-+++-++---+++/   |||   |   | | |
 |||| || |||||  ||||  | ||  |  | |     |/+---++-+-++---+-+-+---++-+-+--+-+---+++-+-+-+----+----++-+---+------+\| | | | ||| ||   |||    |||   |   | | |
 |||| || |||||  ||||  |/++--+--+-+-----+++---++-+-++---+-+-+---++-+-+--+-+---+++-+-+-+---\|    || |   |      ||| | | | ||| ||   |||    |||   |   | | |
 |||| || |||||  ||||  ||||  |  | |     |||   || | ||/--+-+-+---++-+-+--+-+---+++-+-+-+---++----++-+---+------+++-+-+-+-+++-++---+++----+++---+--\| | |
 ||||/++-+++++--++++--++++--+--+-+-----+++---++-+-+++--+-+-+---++-+-+--+-+---+++-+-+-+---++\   || |   |      ||| | | | ||| ||   |||    |||   |  || | |
 ||||||| |||||  |||\--++++--+--+-+-----+++---++-+-+++--+-+-+---++-+-+--+-+---+++-+-+-+---+++---+/ |   |      ||| | | | ||| ||   |||    |||   |  || | |
 ||||||| |||||  ||| /-++++--+--+-+-----+++---++-+-+++-\| | |   || | |  | |   |||/+-+-+---+++---+--+---+------+++-+-+-+-+++-++---+++----+++-\ |  || | |
 ||||||| |||||  ||| | ||||/-+--+-+-----+++---++-+-+++-++-+-+---++-+-+--+-+---+++++-+-+---+++---+--+---+------+++-+-+-+-+++-++-\ |||    ||| | |  || | |
 \++++++-+++++--+++-+-+++++-+--+-+-----+++---++-+-+++-++-+-+---++-+-+--+-+---+++++-+-+---+++---/  |   |      ||| | | | ||| || | |||    ||| | |  || ^ |
  |||||| |||||  ||| | ||||| |  | |     |||   || | ||| || | |   || | |/-+-+---+++++-+-+---+++------+---+------+++-+-+-+-+++-++-+-+++----+++-+-+--++\| |
  |||||| |||||  ||| | ||||| |  | |     |||   || | ||| || | |/--++-+-++-+-+---+++++-+-+---+++------+-\ |      \++-+-+-+-+++-++-+-+++----+/| | |  |||| |
  |||||| |||||  ||| | ||||| |  | |     |||   || | ||| || | ||  || | || | |   ||||| | |/--+++------+-+-+-------++-+-+-+-+++-++-+-+++-\  | | | |  |||| |
  ||\+++-+++++--+++-+-+++++-+--+-+-----+++---++-+-+++-++-+-++--++-+-++-+-+---+/||| | ||  |||      | | |       || | | | ||| ||/+-+++-+--+-+-+-+--++++\|
  || ||| |||||  ||| | ||||| |  | |     |||   || | ||| || | ||/-++-+-++-+-+\  | ||| | ^|  |||      | | | /-----++-+-+-+-+++-++++-+++-+--+-+-+-+-\||||||
  || |||/+++++--+++-+-+++++-+--+-+-----+++---++-+-+++-++-+-+++-++-+-++-+-++--+-+++-+-++--+++------+-+-+\|     || | | | ||| |||| ||| |  | | | | |||||||
  || |||||||||  ||| | ||||| |  | |     |||   || | ||| || | ||| || \-++-+-++--+-+++-+-++--+++------+-+-+++-----++-+-+-+-+++-++++-+++-+--+-+-+-+-++++/||
/-++-+++++++++--+++-+-+++++-+--+-+-----+++---++-+-+++-++-+-+++-++---++-+-++--+-+++-+-++--+++------+\| |||  /--++-+-+-+-+++\|||| ||| |  | | | | |||| ||
| || |||||||||  ||| | ||||| |  | |     |||   || | |||/++-+-+++-++---++-+-++--+-+++-+-++--+++------+++-+++--+-\|| | | | |||||||| ||| |  | | | | |||| ||
| || |||||||||  ||| | ||||| |  | |     |||   ||/+-++++++-+-+++-++---++-+-++--+-+++\| ||  |||      ||| |||  | ||| | | | |||||||| ||| |  | | | | |||| ||
| ||/+++++++++--+++-+\||||| \--+-+-----+++---+/|| \+++++-+-+++-/|   || | ||  | ||||| ||  |||      ||| |||  | ||| | | | |||||||| ||| |  | | | | |||| ||
| ||||||||||||  ||| ||||||| /--+-+-----+++---+-++--+++++-+\|||  |   |^ | ||  | ||||| ||  |||      ||| |||  | ||| | | | |||||||| ||| |  | | | | |||| ||
| ||||||||||||  ||| ||||||| |  | |     |||   | ||  ||||| |||||  |/--++-+-++--+<+++++-++--+++------+++-+++--+-+++-+-+-+-++++++++-+++-+\ | | | | |||| ||
| ||||||||||||  ||| ||||||| |  | |     |||  /+-++--+++++-+++++--++--++-+-++--+-+++++-++--+++------+++-+++-\| ||| | | | |||||||| ||| || | | | | |||| ||
| ||||||||||||  ||| ||||||| |  | |     |||  || ||/-+++++-+++++--++--++-+-++--+-+++++-++-\|||      ||| ||| || ||| | | | |||||||| ||| || | | | | |||| ||
| ||||||||||||  |\+-+++++++-+--+-+-----+++--++-+++-+++++-+++++--++--++-+-++--+-+++++-++-++++------+++-+++-++-+++-/ | | |||||||| ||| || | | | | |||| ||
| |||||||||||\--+-+-+++++++-+--+-+-----+++--++-+++-+++++-+++++--++--++-+-++--+-+++++-++-++++------+++-+++-++-+++---+-+-++/||||| ||| || | | | | |||| ||
| |||||||||||   | | ||\++++-+--+-+-----+++--++-+++-+++++-+++++--++--++-+-++--+-+++++-++-++/|      ||| ||| || |||   | | || ||||| ||| || | | | | |||| ||
| |||||||||||   | | || |||| |  | |   /-+++--++-+++-+++++-+++++--++--++-+-++--+-+++++-++-++-+------+++-+++-++-+++---+-+-++-+++++-+++-++-+\| | | |||| ||
| |||||||||||   | | || |||| |  | |   | |||  || ||| |\+++-+++++--++--++-+-++--+-+++++-++-++-+------+++-+++-++-+++---+-+-++-+++++-+++-++-+++-+-+-+/|| ||
| |||||||||||  /+-+-++-++++-+--+-+---+-+++--++-+++-+-+++-+++++--++--++-+-++--+-+++++-++-++-+--\   ||| ||| || |||   |/+-++-+++++-+++-++-+++-+-+-+\|| ||
| |||||||||||  || | || |||| |  | |   | |||  || ||| | ||| |||||  ||  || | ||  | ||||| || || |  |   ||| ||| || |||   ||| || ||||| ||| || ||| | | |||| ||
| |||||||||||  || | || |||| |  | |   | |||  || ||| | ||| |||||  ||  || | ||  | |\+++-++-++-+--+---+++-+++-++-+++---+++-++-+++++-+++-++-+++-/ | |||| ||
| |||||||||||  || |/++-++++-+--+-+---+-+++--++-+++-+-+++-+++++--++-\|| | ||  | | ||| || || |  |   \++-+++-++-+++---+++-++-+/||| ||| || |||   | |||| ||
| |||||||||||  || |||| |||| |  \-+---+-+++--++-+++-+-+++-+++++--++-+++-/ ||  | | ||| || ||/+--+----++-+++-++-+++---+++-++-+-+++-+++-++-+++--\| |||| ||
| |||||||||||  || |||| |||| |    |   | ||| /++-+++-+-+++-+++++--++-+++---++--+-+-+++-++-++++--+----++-+++-++-+++---+++-++-+-+++-+++-++-+++--++\|||| ||
| |||||||||||  || |||| ||||/+----+---+-+++-+++-+++-+-+++-+++++--++-+++---++--+-+-+++-++-++++--+----++-+++\|| |||   ||| || | ||| ||| || |||  ||||||| ||
| |||||||||||  || |||| |\++++----+---+-/|| ||| ||| | ||| |||||  || |||   ||  | | ||| || ||||  |    || |||||| |||   ||| || | ||| ||| || |||  ||||||| ||
| |||||||||||  || |||| | ||||    |   |  || ||| ||| | ||| ||||| /++-+++---++--+-+-+++-++\||||  |    || |||||| |||   ||| || | ||| ||| || |||  ||||||| ||
| |||||||||||  || |||| | \+++----+---+--++-+++-+++-+-+++-+++++-+++-+++---++--+-+-/|| |||||||  |    ||/++++++-+++\  ||| || | ||| ||| || |||  ||||||| ||
| |||||||||||  || |||| |  |||    |   |  || ||| ||| | ||| ||||| ||| |||   ||  | |  || |||||||  |    ||||||||| ||||  ||| || | ||| ||| || |||  ||||||| ||
| |||||||||||  || |||| |  |||    |   |  || ||| ||| | ||| ||||| ||| |||   ||  | |  || |||||||/-+----+++++++++-++++--+++-++-+-+++\||| || |||  ||||||| ||
| |||||||||||  || |||| |  |||    |   |  || ||| ||| | ||| ||||| ||| |||   ||  | |  || |||||||| |    ||||||||| ||||  ||| || | ||||||| || |||  ||||||| ||
| |||||||||||  || |||| |  |||    |   |  || ||| ||| \-+++-+++++-+++-+++---++--+-+--++-++++++++-+----+++++++++-++++--+++-++-+-++++/|| || |||  ||||||| ||
| |||||||||||  || \+++-+--+++----+---+--++-+++-+++---+++-++/|| ||| |||   ||/-+-+--++\|||||||| |    |||||||||/++++--+++-++-+-++++-++-++-+++-\||||||| ||
| |||||||||||  ||  |||/+--+++----+---+--++-+++-+++---+++-++-++-+++\|||   ||| | |  ||||||||||| |    ||||||||||||||  ||| || | |||| || || ||| |||||||| ||
| ||||^||||||  ||  |||||  |||    |   |  || ||| |||   ||| || || |||||||   ||| | |  ||||||||||| |    ||||||||||||||  |\+-++-+-++++-++-++-+++-+++++/|| ||
| |\+++++++++--++--+++++--+++----+---+--++-+++-+++---+++-++-++-+/|||\+---+++-+-+--+++++++++++-+----++++++++++++++--+-+-++-+-++++-++-++-+++-++/|| || ||
| | |||||||||  ||  |||||  |||    |   |  || ||| |||   ||| || || | ||| |   ||| | |  ||||||||||| |  /-++++++++++++++-\| | || | |||| || || ||| || || || ||
| | ||||||\++--++--+++++--+++----+---+--++-+++-+++---+++-++-++-+-+++-+---+++-+-/  ||||||||||| |  | |||||||||||||| || | || | |||| || || ||| || || || ||
|/+-++++++-++-\||  |||||  ||\----+---+--++-+++-+++---+++-+/ || | ||| |   ||| |    ||||||||||| |  | |||||||||||||| || | || | |||| || || ||| || || || ||
||| |||||| || |||  |||||  ||     |   |  || ||| |||   ||| |/-++-+-+++-+\  ||| |    ||||||||||| |  | |||||||||||||| || | || | |||| || || ||| || || || ||
||| |||||| || |||  |||||  ||     |   |  || ||| |||   ||| || |\-+-+++-++--+/| |    ||||||||||\-+--+-++++++++++++++-++-+-++-+-+++/ || || ||| || || || ||
||| |||||| || |||  |||||  ||     |   |  || ||| |||   ||| || |  | ||| ||  | | |    ||||||||||  |  | ||\++++++++++/ || |/++-+-+++--++-++\||| || || || ||
||| |||||| || |||  |||||  ||     |   |  || ||| |||   ||| || |  | ||| ||  | | |    ||||||||||  |  | || ||||||||||  || |||| | |||  || |||||| || || || ||
||| |||||| || ||| /+++++--++-----+---+--++-+++-+++---+++-++-+--+-+++-++--+-+-+----++++++++++--+--+-++\||||||||||  || |||| | |||  || |||||| || || || ||
||| |||||| || ||| ||||||/-++-----+---+--++-+++-+++---+++-++-+--+-+++-++--+-+-+----++++++++++--+--+-+++++++++++++--++-++++-+-+++-\|| |||||| || || || ||
||| |||||| || ||| ||||||| ||     |   |  || ||| |||   ||| || |  | ||| ||  | | |    ||||||||||  |  | |||||||||||||  || |||| | ||| ||| |||||| || || || ||
||| |||||| || ||| ||||v|| ||     |   |  || ||| |||   ||| || |  | ||| ||  | | |    ||||||||||  |  | |||||||||||||  || |||| | ||| ||| |||||| || || || ||
||| |||||| || |||/+++++++-++----\|   |  || ||| |||   ||| || |  \-+++-++--+-+-+----+++++/||||  |  | |||||||||||||  || |||| | ||| ||| |||||| || || || ||
||| |||||| || ||||||||||| ||    ||   |  || ||| |\+---+++-++-+----+++-++--+-+-+----+++++-++++--+--+-+++++++++++++--++-++++-+-+++-+++-++++++-++-++-/| ||
||| |||||| || ||||||||||| ||    ||   |  || ||| | |   ||| |\-+----+++-+/  | | |    ||||| ||||  |  | ||||||||||||| /++-++++-+-+++-+++-++++++-++-++--+\||
||| |||||| || ||||||||||| ||    ||   |  || ||| | |   ||| |  |   /+++-+---+-+-+--\ ||||| ||||  |  | ||||||||||||| ||| |||| | ||| ||| |||||| || ||  ||||
||| |||||| || ||||||||||| ||    ||   |  || ||| | |   ||\-+--+---++++-+---+-+-+--+-+++++-++++--+--+-+++++++++++++-+++-++++-+-+++-+/| |||||| || ||  ||||
\++-++++++-++-+++++++++++-++----++---+--++-+++-+-+---++--+--+---++++-+---+-+-+--+-+++++-++++--+--+-/|||||||||||| ||| |||| | ||| | | |||||| || ||  ||||
 || |||||| || ||||||||||| ||    ||   |  || ||| | |   ||  |  |   |||| |   | | \--+-+++++-++++--+--+--++++++++++++-++/ |||| | ||| | | |||||| || ||  ||||
 || |||||| || |||||||||\+-++----++---+--++-+++-+-+---++--+--+---++++-+---+-+----+-+++++-+/||  |  |  |||||||||||| ||  |||| | ||| | | |||||| || ||  ||||
 || |||||| || ||||||||| | ||    ||   |  || ||| | |   \+--+--+---++++-+---+-+----+-+++++-+-++--+--+--+++++++++/|| ||  |||| | ||| | | |||||| || ||  ||||
 || |||||| || ||||||||| | ||  /-++---+--++-+++-+-+----+--+--+---++++-+---+-+----+-+++++-+-++--+--+--+++++++++-++-++-\|||| | ||| | | |||||| || ||  ||||
 || |||||| \+-+++++++++-+-++--+-++---+--++-+++-+-+----+--+--+---++++-+---+-+----+-+++++-+-++--+--+--+++++++++-++-++-+++/| | ||| | | |||||| || ||  ||||
 || ||||||  | ||||\++++-+-++--+-++---+--++-+++-+-+----+--+--+---++++-+---+-+----+-+++++-+-++--+--+--+/||||||| || || ||| | | ||| | | |||||| || ||  ||||
 || ||||||  | |||| |||| | ||  | ||   |  || ||| | |    |  |  |   |||| |   \-+----+-+++++-+-++--+--+--+-+++++++-++-++-+++-+-+-+++-+-+-+++++/ || ||  ||||
 || ||||||  | |||| |||| | ||  | ||   |  \+-+++-+-+----+--+--+---++++-+-----+----+-+++++-+-++--+--+--+-+++++++-/| || ||\-+-+-+++-+-+-++/||  || ||  ||||
 || ||||||/-+-++++-++++-+-++--+-++---+---+-+++-+-+----+\ |  |   |||v |     |    | ||||| | ||  |  |  | |||||||  | || ||  | | ||| | | || ||  || ||  ||||
 || |||\+++-+-++++-++++-+-++--+-++---+---+-++/ | |    || |  |   |||| |     |  /-+-+++++-+-++--+--+--+-+++++++--+-++-++--+-+-+++-+-+-++-++--++-++\ ||||
 || ||| ||| | |||| |||| | ||  | ||   |   | ||  | |    || | /+---++++-+----\|  | | |\+++-+-++--+--+--+-+++++++--+-++-++--+-+-+++-+-/ || ||  || ||| ||||
 || ||| |\+-+-++++-++++-+-++--+-++---+---/ ||  | |    || | |\---++++-+----++--+-+-+-+++-+-++--+--+--/ |||||||  | || ||  | | ||| |   || ||  || ||| ||||
 || ||| | | | |||| |||| | || /+-++---+-----++--+-+----++-+-+----++++-+----++--+-+-+-+++-+-++--+--+----+++++++--+-++-++-\| | ||| |   || ||  || ||| ||||
 || |\+-+-+-+-++++-++++-+-++-++-++---+-----++--+-+----++-+-+----++++-+----++--+-+-+-+++-+-+/  |  \----+++++++--+-+/ || || | ||| |   || ||  || ||| ||||
 || | | | | | |||| |||| | || || ||   |     ||  | |    || | |    |||| |    ||  | | | ||| | |   |       ||\++++--+-+--++-++-+-+++-+---++-++--++-+/| ||||
 || | | | | | |||| |||| | || || ||/--+-----++--+\|    || | |    |||| |    ||  | | | ||| | |   |      /++-++++--+-+-\|| || | ||| |   || ||  || | | ||||
 |\-+-+-+-+-+-++/| |||\-+-++-++-+++--+-----++--+++----++-+-+----++/| |    ||  | | | ||| | |   |      ||| ||||  | | ||| || | ||| |   || ||  || | | ||||
 |  | \-+-+-+-++-+-+++--+-++-++-+++--+-----++--+++----++-+-+----++-+-+----++--+-+-+-+++-+-+---+------+/| ||||  | | ||| || | |\+-+---++-++--++-+-+-++/|
 |  |   | | | || | |||/-+-++-++\|||  |     ||  \++----++-+-+----++-+-+----++--+-+-/ ||| | |   |      | | ||||  | | ||| || | \-+-+---++-/|  || | | || |
 |  |   | | | || | |||| | || |\++++--+-----++---++----++-+-+----++-+-+----++--+-+---+++-+-+---+------+-+-++++--+-+-+/| || |   | |   ||  |  || | | || |
 |  |   | | | || | |||| | || | ||||  |     ||   ||    || | |    |\-+-+----++--+-+---+++-+-+---+------+-+-++++--+-+-+-+-++-+---+-+---+/  |  || | | || |
 |  |   | \-+-++-+-++++-+-++-+-++++--+-----++---++----+/ | |    |  | |    ||  | |   ||| | |   |      | | ||\+--+-+-+-+-++-/   | |   |   |  || | | || |
 |  |   |   | || | |||| | || | ||||  |     ||   ||    |  | \----+--+-+----/|  | |   ||| | |  /+------+-+-++-+--+-+-+-+-++-----+\|   |   |  || | | || |
 |  |/--+---+-++-+-++++-+-++-+-++++--+-\   ||   ||    |  |      |  | |     |  \-+---+++-+-+--++------+-+-++-+--+-+-+-+-++-----+++---+---+--++-+-/ || |
 |  ||  |   | || | |||| | || | ||||  | |   \+---++----+--+------+--+-+-----+----+---+++-+-+--++------+-+-++-+--+-+-+-+-++-----+++---+---+--++-/   || |
 |  ||  |   | || \-++++-+-++-+-+/\+--+-+----+---++----+--+------+--+-+-----+----+---+++-+-+--++------+-+-++-+--/ | | | ||     |||   |   |  ||     || |
 |  ||  |   | ||   |||| | || | |  \--+-+----+---/|    |  |      |  | |     \----+---/|| | |  ||      | | || |    | | | ||     |||   |   |  ||     || |
 |  ||  |   | ||   |||| \-++-+-+-----+-+----+----+----+--+------+--+-+----------+----++-+-+--++------+-+-++-+----+-+-+-++-----++/   |   |  ||     || |
 |  ||  |   | ||   ||||   || | |     | |    |    |    |  |      |  | |          |    || | |  ||      | | || |    | | | |\-----++----+---+--++-----++-/
 \--++--+---+-/|   |||\---++-+-/     | |    |    |    |  |      |  | |          |    || | |  || /----+-+-++-+----+-+-+-+------++----+---+--++-\   ||  
    ||  |   |  |   |||    || |       | v    |    |    |  |      |  | |          |    || | |  || |    | | || |    \-+-+-+------++----+---+--++-+---+/  
    ||  |   |  |   |||    || |       | |    |    |    |  |      |  | |          |    || | |  \+-+----+-+-++-+------+-+-+-->---+/    |   |  || |   |   
    ||  |   |  |   |||    \+-+-------+-+----+----+----+--+------+--+-+----------+----++-+-+---+-+----+-+-++-+------+-+-+------/     |   |  || |   |   
    ||  |   |  |   |||     | |       \-+----+----+----+--+------+--+-+----------+----++-+-+---+-+----+-+-++-+------+-+-+------------+---/  || |   |   
    ||  |   |  |   |||     | |         |    \----+----+--+------+--+-+----------+----++-+-+---+-+----+-+-+/ |      | | |            |      || |   |   
    ||  |   \--+---+++-----+-+---------+---------+----+--+------+--+-+----------+----++-+-+---+-+----+-+-+--+------+-/ |            |      || |   |   
    \+--+------+---++/     | |         |         |    |  |      \--+-+----------/    || | |   | |    | | |  |      |   |            |      || |   |   
     |  |      \---++------+-+---------+---------+----+--+---------+-+---------------++-+-+---/ |    | | |  \------+---+------------+------/| |   |   
     |  |          ||      | \---------+---------+----+--+---------+-+---------------++-+-+-----+----+-+-+---------+---/            |       | |   |   
     |  |          ||      |           |         |    |  \---------+-+---------------/| | |     |    | | |         |                |       | |   |   
     |  |          |\------+-----------+---------+----/            | |                \-+-+-----+----+-+-+---------+----------------/       | |   |   
     |  |          |       \-----------+---------+-----------------+-+------------------+-+-----+----+-+-/         |                        | |   |   
     \--+----------+-------------------/         |                 | |                  | \-----+----+-+-----------+------------------------/ |   |   
        |          |                             |                 | \------------------+-------+----+-+-----------+--------------------------+---/   
        |          \-----------------------------+-----------------/                    |       |    \-+-----------/                          |       
        \----------------------------------------+--------------------------------------+-------+------/                                      |       
                                                 \------------------------------------->/       \---------------------------------------------/       
"""

inputfstr = r"""
/>-<\  
|   |  
| /<+-\
| | | v
\>+</ |
  |   ^
  \<->/
"""

import re, collections, itertools

tracks = []
carts = []


class Crash(Exception):
    pass


class Point(object):
    def __init__(self, x, y):
        self.x = x
        self.y = y

class Cart(object):
    def __init__(self, loc, curr):
        self.loc = loc
        self.curr = curr
        self.intersection_gen = itertools.cycle('LSR')
    def __str__(self):
        return "%x:%s" % (id(self), str(self.loc))
    def tick(self):
        if self.curr == '>':
            next_space = (self.loc[0]+1, self.loc[1])
        elif self.curr == '<':
            next_space = (self.loc[0]-1, self.loc[1])
        elif self.curr == 'v':
            next_space = (self.loc[0], self.loc[1]+1)
        elif self.curr == '^':
            next_space = (self.loc[0], self.loc[1]-1)
        else:
            assert False

        curr_chunk = tracks[self.loc[1]][self.loc[0]]
        if curr_chunk not in r'-|/\+':
            print("INVALID CURR CHUNK ", self.loc, repr(curr_chunk))
            assert False

        self.loc = next_space
        next_chunk = tracks[self.loc[1]][self.loc[0]]
        
        for c in carts:
            if c != self and c.loc == self.loc:
                print("CRASH next_chunk", next_chunk, " cart loc", c.loc)
                raise Crash(self, c)
    
        if next_chunk in '-|':
            pass
        elif next_chunk == '/':
            if self.curr in '><':
                self.turn('L')
            elif self.curr in 'v^':
                self.turn('R')
        elif next_chunk == '\\':
            if self.curr in '><':
                self.turn('R')
            elif self.curr in 'v^':
                self.turn('L')
        elif next_chunk == '+':
            self.turn(next(self.intersection_gen))
        else:
            print("INVALID NEXT", self.loc, next_space, repr(next_chunk))
            assert False

    def turn(self, direction):
        if direction == 'S':
            pass
        elif direction == 'L':
            if self.curr == '>':
                self.curr = '^'
            elif self.curr == '<':
                self.curr = 'v'
            elif self.curr == 'v':
                self.curr = '>'
            elif self.curr == '^':
                self.curr = '<'
        elif direction == 'R':
            if self.curr == '>':
                self.curr = 'v'
            elif self.curr == '<':
                self.curr = '^'
            elif self.curr == 'v':
                self.curr = '<'
            elif self.curr == '^':
                self.curr = '>'
        else:
            assert False

def display_tracks(tracks, carts):
    for y, t in enumerate(tracks):
        for x, c in enumerate(t):
            found = False
            for cart in carts:
                if cart.loc == (x, y):
                    print(cart.curr, end='')
                    found = True
                    break
            if not found:
                print(c, end='')
        print()


def main():
    lines = inputstr.splitlines()[1:]
    print("initial")
    for y, l in enumerate(lines):
        print(l)
        for x, c in enumerate(l):
            if c in '><v^':
                carts.append(Cart((x,y), c))
        tracks.append(l.replace("<", "-").replace(">", "-").replace("^", "|").replace("v", "|"))
    print()

    last_run = False
    for i in range(4000000):
        to_remove = set()
        for cart in carts:
            try:
                cart.tick()
            except Crash as e:
                print("CRASH23", e.args)
                to_remove.add(e.args[0])
                to_remove.add(e.args[1])

        print("ROUND %03d" % (i+1))
        # print("REMOVING", to_remove)
        for cart in to_remove:
            print("Removing cart", cart)
            carts.remove(cart)

        if last_run:
            print("LAST CART", carts[0].loc)
            break

        if len(carts) == 1:
            last_run = True

        # display_tracks(tracks, carts)






if __name__ == '__main__':
    main()
